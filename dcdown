#!/bin/bash

# ðŸ“ Resolve the absolute path to this script
SOURCE="${BASH_SOURCE[0]:-$0}"
while [ -h "$SOURCE" ]; do
  DIR="$(cd -P "$(dirname "$SOURCE")" >/dev/null 2>&1 && pwd)"
  SOURCE="$(readlink "$SOURCE")"
  [[ $SOURCE != /* ]] && SOURCE="$DIR/$SOURCE"
done
REPO_DIR="$(cd -P "$(dirname "$SOURCE")" >/dev/null 2>&1 && pwd)"

# ðŸ†˜ Help output
if [[ "$1" == "--help" || "$1" == "-h" ]]; then
  echo "BECAREFUL: THIS WILL RM CONTAINER PERMANENTLY!!!"
  echo "Usage:"
  echo "  dcdown                 # shuts down docker compose project for current directory"
  echo "  dcdown <project-name>  # shuts down docker compose project with custom name"
  echo
  echo "Example:"
  echo "  If you ran:  dcup node v0.00 sh myproject"
  echo "  Then you'd see:  myproject-node-1"
  echo "  And shutdown with: dcdown myproject"
  echo
  echo "This is a manual wrapper for:"
  echo "  docker compose --file ./docker-compose.yaml --project-name <name> down"
  exit 0
fi

# ðŸ“¦ Determine project name
project="${1:-$(basename "$PWD")}"

echo "ðŸ“¦ Shutting down project: $project"

docker compose \
  --file "${REPO_DIR}/docker-compose.yaml" \
  --project-name "$project" \
  down

