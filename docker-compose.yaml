services:
  node:
    image: ${FULL_IMAGE_TAG}
    build:
      context: ./node
      target: ${DEFAULT_BUILD_TARGET}
      args:
        APP_DIR: ${APP_DIR}
        FILES_DIR: ${FILES_DIR}
    working_dir: ${APP_DIR}
    entrypoint: ["dumb-init", "--"]  # âœ… explicitly set entrypoint
    stdin_open: true
    tty: true
    volumes:
      - ${HOST_WORKDIR:-.}:${APP_DIR}
      - ${APP_DIR}/node_modules
      - /var/run/docker.sock:/var/run/docker.sock  # enable docker passthru
    ports:
      - ${PORT_MAPPINGS:-3000:80}  # ðŸ‘ˆ dynamic with fallback
    command: ["sh", "-i"]

  python:
    build:
      context: ./python
    image: ${DOCKERHUB_NAMESPACE}/${IMAGE_PREFIX}-python
    working_dir: ${APP_DIR}
    stdin_open: true
    tty: true
    volumes:
      - ${HOST_WORKDIR:-.}:${APP_DIR}

  arch:
    build:
      context: ./arch
    image: ${DOCKERHUB_NAMESPACE}/${IMAGE_PREFIX}-arch
    working_dir: ${APP_DIR}
    stdin_open: true
    tty: true
    volumes:
      - ${HOST_WORKDIR:-.}:${APP_DIR}
      - /var/run/docker.sock:/var/run/docker.sock  # enable docker passthru

  debian:
    build:
      context: ./debian
    image: ${DOCKERHUB_NAMESPACE}/${IMAGE_PREFIX}-debian
    working_dir: ${APP_DIR}
    stdin_open: true
    tty: true
    volumes:
      - ${HOST_WORKDIR:-.}:${APP_DIR}
      - /var/run/docker.sock:/var/run/docker.sock  # enable docker passthru

